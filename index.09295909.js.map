{"version":3,"file":"index.09295909.js","sources":["../../node_modules/@project-serum/sol-wallet-adapter/dist/esm/index.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport EventEmitter from 'eventemitter3';\nimport { PublicKey } from '@solana/web3.js';\nimport bs58 from 'bs58';\nexport default class Wallet extends EventEmitter {\n    constructor(provider, _network) {\n        super();\n        this._network = _network;\n        this._publicKey = null;\n        this._popup = null;\n        this._handlerAdded = false;\n        this._nextRequestId = 1;\n        this._autoApprove = false;\n        this._responsePromises = new Map();\n        this.handleMessage = (e) => {\n            var _a;\n            if ((this._injectedProvider && e.source === window) ||\n                (e.origin === ((_a = this._providerUrl) === null || _a === void 0 ? void 0 : _a.origin) && e.source === this._popup)) {\n                if (e.data.method === 'connected') {\n                    const newPublicKey = new PublicKey(e.data.params.publicKey);\n                    if (!this._publicKey || !this._publicKey.equals(newPublicKey)) {\n                        if (this._publicKey && !this._publicKey.equals(newPublicKey)) {\n                            this.handleDisconnect();\n                        }\n                        this._publicKey = newPublicKey;\n                        this._autoApprove = !!e.data.params.autoApprove;\n                        this.emit('connect', this._publicKey);\n                    }\n                }\n                else if (e.data.method === 'disconnected') {\n                    this.handleDisconnect();\n                }\n                else if (e.data.result || e.data.error) {\n                    const promises = this._responsePromises.get(e.data.id);\n                    if (promises) {\n                        const [resolve, reject] = promises;\n                        if (e.data.result) {\n                            resolve(e.data.result);\n                        }\n                        else {\n                            reject(new Error(e.data.error));\n                        }\n                    }\n                }\n            }\n        };\n        this._beforeUnload = () => {\n            void this.disconnect();\n        };\n        if (isInjectedProvider(provider)) {\n            this._injectedProvider = provider;\n        }\n        else if (isString(provider)) {\n            this._providerUrl = new URL(provider);\n            this._providerUrl.hash = new URLSearchParams({\n                origin: window.location.origin,\n                network: this._network,\n            }).toString();\n        }\n        else {\n            throw new Error('provider parameter must be an injected provider or a URL string.');\n        }\n    }\n    handleConnect() {\n        var _a;\n        if (!this._handlerAdded) {\n            this._handlerAdded = true;\n            window.addEventListener('message', this.handleMessage);\n            window.addEventListener('beforeunload', this._beforeUnload);\n        }\n        if (this._injectedProvider) {\n            return new Promise((resolve) => {\n                void this.sendRequest('connect', {});\n                resolve();\n            });\n        }\n        else {\n            window.name = 'parent';\n            this._popup = window.open((_a = this._providerUrl) === null || _a === void 0 ? void 0 : _a.toString(), '_blank', 'location,resizable,width=460,height=675');\n            return new Promise((resolve) => {\n                this.once('connect', resolve);\n            });\n        }\n    }\n    handleDisconnect() {\n        if (this._handlerAdded) {\n            this._handlerAdded = false;\n            window.removeEventListener('message', this.handleMessage);\n            window.removeEventListener('beforeunload', this._beforeUnload);\n        }\n        if (this._publicKey) {\n            this._publicKey = null;\n            this.emit('disconnect');\n        }\n        this._responsePromises.forEach(([, reject], id) => {\n            this._responsePromises.delete(id);\n            reject(new Error('Wallet disconnected'));\n        });\n    }\n    sendRequest(method, params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (method !== 'connect' && !this.connected) {\n                throw new Error('Wallet not connected');\n            }\n            const requestId = this._nextRequestId;\n            ++this._nextRequestId;\n            return new Promise((resolve, reject) => {\n                var _a, _b, _c, _d;\n                this._responsePromises.set(requestId, [resolve, reject]);\n                if (this._injectedProvider) {\n                    this._injectedProvider.postMessage({\n                        jsonrpc: '2.0',\n                        id: requestId,\n                        method,\n                        params: Object.assign({ network: this._network }, params),\n                    });\n                }\n                else {\n                    (_a = this._popup) === null || _a === void 0 ? void 0 : _a.postMessage({\n                        jsonrpc: '2.0',\n                        id: requestId,\n                        method,\n                        params,\n                    }, (_c = (_b = this._providerUrl) === null || _b === void 0 ? void 0 : _b.origin) !== null && _c !== void 0 ? _c : '');\n                    if (!this.autoApprove) {\n                        (_d = this._popup) === null || _d === void 0 ? void 0 : _d.focus();\n                    }\n                }\n            });\n        });\n    }\n    get publicKey() {\n        return this._publicKey;\n    }\n    get connected() {\n        return this._publicKey !== null;\n    }\n    get autoApprove() {\n        return this._autoApprove;\n    }\n    connect() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._popup) {\n                this._popup.close();\n            }\n            yield this.handleConnect();\n        });\n    }\n    disconnect() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._injectedProvider) {\n                yield this.sendRequest('disconnect', {});\n            }\n            if (this._popup) {\n                this._popup.close();\n            }\n            this.handleDisconnect();\n        });\n    }\n    sign(data, display) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!(data instanceof Uint8Array)) {\n                throw new Error('Data must be an instance of Uint8Array');\n            }\n            const response = (yield this.sendRequest('sign', {\n                data,\n                display,\n            }));\n            const signature = bs58.decode(response.signature);\n            const publicKey = new PublicKey(response.publicKey);\n            return {\n                signature,\n                publicKey,\n            };\n        });\n    }\n    signTransaction(transaction) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const response = (yield this.sendRequest('signTransaction', {\n                message: bs58.encode(transaction.serializeMessage()),\n            }));\n            const signature = bs58.decode(response.signature);\n            const publicKey = new PublicKey(response.publicKey);\n            transaction.addSignature(publicKey, signature);\n            return transaction;\n        });\n    }\n    signAllTransactions(transactions) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const response = (yield this.sendRequest('signAllTransactions', {\n                messages: transactions.map((tx) => bs58.encode(tx.serializeMessage())),\n            }));\n            const signatures = response.signatures.map((s) => bs58.decode(s));\n            const publicKey = new PublicKey(response.publicKey);\n            transactions = transactions.map((tx, idx) => {\n                tx.addSignature(publicKey, signatures[idx]);\n                return tx;\n            });\n            return transactions;\n        });\n    }\n    diffieHellman(publicKey) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!(publicKey instanceof Uint8Array)) {\n                throw new Error('Data must be an instance of Uint8Array');\n            }\n            const response = (yield this.sendRequest('diffieHellman', {\n                publicKey,\n            }));\n            return response;\n        });\n    }\n}\nfunction isString(a) {\n    return typeof a === 'string';\n}\nfunction isInjectedProvider(a) {\n    return (isObject(a) && 'postMessage' in a && typeof a.postMessage === 'function');\n}\nfunction isObject(a) {\n    return typeof a === 'object' && a !== null;\n}\n//# sourceMappingURL=index.js.map"],"names":["this"],"mappings":"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"}